<p><strong>每个人都有无法实现的梦想。或许是那梦想需要太多时间和金钱，譬如开跑车驰骋，驾飞机翱翔;或许是那梦想太过于离谱，例如与异形进行星球大战，与吸血鬼拼个刺刀见红;或许是那梦想会违反法律，譬如血洗乐园，夜半尾行。但不管能否实现，它们总盘旋在你脑海里，每一天，让你浮想联翩。这就是为什么会有一个上亿美元的产业来帮助人们实现各种光怪陆离的白日梦;这就是为什么会有电子游戏。</strong> —— 《DOOM 启世录》[注1]</p>

<p>大家都知道约翰·卡马克和他不朽的作品，他为游戏世界带来的创造性工作是划时代的。今天给大家介绍一些，用 <code class="highlighter-rouge">qemu</code> 创建 <code class="highlighter-rouge">dos</code> 虚拟机并安装 Doom。[注2]</p>

<h2 id="安装-qemu">安装 qemu</h2>

<p>如今三条腿的牛蛙好找，有软盘的电脑难寻，如果想体验 DOS 我们 需要一个虚拟环境。这里我推荐 <code class="highlighter-rouge">qemu</code>（这当然也是个人爱好，因为 <a href="https://openresty.org/en/">openresty</a> 的作者曾经<a href="https://www.weibo.com/1834459124/GFOybDY4F">高度评价 qemu 的作者</a>）。</p>

<p>首先我们来安装 <code class="highlighter-rouge">qemu</code>：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>qemu
</code></pre></div></div>

<p>安装完成之后，输入 <code class="highlighter-rouge">qemu</code> 然后用 <code class="highlighter-rouge">tab</code> 键补完，你会发现多了一堆命令。 其中：</p>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>qemu-edid</td>
      <td>测试 edid generator 的工具</td>
    </tr>
    <tr>
      <td>qemu-img</td>
      <td><code class="highlighter-rouge">qemu</code> 的磁盘管理工具，可以用来创建 <code class="highlighter-rouge">qemu</code> 镜像</td>
    </tr>
    <tr>
      <td>qemu-nbd</td>
      <td><code class="highlighter-rouge">qemu</code> 的网络块设备服务器</td>
    </tr>
    <tr>
      <td>qemu-system-*</td>
      <td><code class="highlighter-rouge">qemu</code> 启动虚拟机的命令，星号代替不同的架构，比如i386和x86_64</td>
    </tr>
  </tbody>
</table>

<h2 id="用-qemu-安装-dos">用 qemu 安装 dos</h2>

<p>然后我们来安装 <code class="highlighter-rouge">dos</code>。安装 <code class="highlighter-rouge">dos</code> 有两种方法，一种是选择 <code class="highlighter-rouge">dos</code> 安装镜像，然后大家复习一下重装 <code class="highlighter-rouge">windows</code> 系统的过程：格式化硬盘、分区、安装、安装不成功重新格式化再来一遍，嗯，非常有挑战性。大家可以下载 <a href="http://www.freedos.org/download/">freedos</a>，它还附带了<a href="http://wiki.freedos.org/install/">安装教程</a>。至于如何使用 <code class="highlighter-rouge">qemu</code> 从头创建一个 <code class="highlighter-rouge">dos</code> 虚拟机，可以参考<a href="https://opensource.com/article/17/10/run-dos-applications-linux">这篇文章</a>（总的来说就是先用 <code class="highlighter-rouge">qemu-img</code> 创建一个空的镜像，然后用 <code class="highlighter-rouge">qemu-system-i386</code> 跑起来，模拟用光盘安装 <code class="highlighter-rouge">dos</code> 的过程，但假如你是 mac 用户，记得把这篇文章里面示例中的 <code class="highlighter-rouge">-display gtk</code> 去掉，不要问我为什么会知道，没有故事）。</p>

<p>但我作为一个良心的攻略制作者，当然会为大家提供“爽到”攻略。这个攻略里面，你只需要按如下步骤操作：</p>

<ol>
  <li>下载<a href="https://github.com/palmercluff/qemu-images/tree/master/freedos-1.2">freedos-1.2.7z</a> 到你喜欢的目录并解压缩</li>
  <li>执行如下命令：<code class="highlighter-rouge">qemu-system-i386 -hda freedos-1.2.qcow2 -m 256</code>[注3]</li>
</ol>

<p>然后你就获得了一个运行中的 <code class="highlighter-rouge">dos</code> 虚拟机了！惊不惊喜，高不高兴？</p>

<h2 id="安装-doom">安装 Doom</h2>

<p>接下来，我们安装 Doom。</p>

<p>首先，我们在 <code class="highlighter-rouge">freedos-1.2.qcow2</code> 所在的目录下，创建一个新的目录，目录名随意（以 dosfiles) 为例。</p>

<p>然后我们下载<a href="https://www.dosgamesarchive.com/download/doom/">Doom</a>，到 dosfiles 目录并解压缩。</p>

<p>接下来，我们用如下命令启动 <code class="highlighter-rouge">dos</code> 虚拟机（记住，启动之后就不要修改 dosfiles 目录了）。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qemu-system-i386 <span class="nt">-hda</span> freedos-1.2.qcow2 <span class="nt">-m</span> 256 <span class="nt">-drive</span> <span class="nv">file</span><span class="o">=</span>fat:rw:dosfiles/,format<span class="o">=</span>raw <span class="nt">-boot</span> <span class="nv">order</span><span class="o">=</span>c
</code></pre></div></div>

<p>这道命令会让把 dosfiles 目录挂到虚拟机中。在虚拟机中，输入 <code class="highlighter-rouge">D:</code> 进入 D 盘（一个有年代感的词，“阿Sir，我唔用 windows 好多年啦！”）。 <code class="highlighter-rouge">dir</code> 一下，你如看见如下界面：</p>

<p><img src="images/doom-install-1.jpg" alt="安装界面" /></p>

<p><code class="highlighter-rouge">cd DOOM19S</code> 进入目录，运行 <code class="highlighter-rouge">INSTALL.bat</code>，开始安装过程。</p>

<p>安装完成之后，你就可以开始你的“毁灭之路”了，猎运亨通！</p>

<p><img src="images/doom-install-2.jpg" alt="DOOM" /></p>

<ul>
  <li>[注1] 我想读者已经留意到了，本文标题就是致敬这本书。</li>
  <li>[注2] 对于理工科来说，过去的经典是不必再读的（学物理的人不会再去读《自然哲学的数学原理》），但是游戏不一样，即使在画面已经进步了无数个世代，一些伟大的游戏依然能让我们愉悦，让我有所发现，很大原因是：它们的成功是建立在对游戏的本质理解上的。在这种意义上，玩一些旧游戏有“阅读原典”的作用。</li>
  <li>[注3] <a href="https://people.gnome.org/~markmc/qcow-image-format.html">qcow2 镜像格式</a></li>
</ul>
